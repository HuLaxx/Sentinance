# Sentinance: Complete Workflow & Integration Map

## ğŸ”„ End-to-End Data Workflow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           DATA FLOW WORKFLOW                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                     1. DATA INGESTION (Real-Time)                      â”‚  â”‚
â”‚  â”‚                                                                         â”‚  â”‚
â”‚  â”‚   Binance â”€â”€â”                                                          â”‚  â”‚
â”‚  â”‚   Coinbase â”€â”¼â”€â”€â–º multi_exchange.py â”€â”€â–º fetch_all_exchanges()          â”‚  â”‚
â”‚  â”‚   Kraken â”€â”€â”€â”˜         â”‚                                                â”‚  â”‚
â”‚  â”‚                       â–¼                                                â”‚  â”‚
â”‚  â”‚              calculate_vwap() â”€â”€â–º aggregated prices                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                               â”‚
â”‚                              â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                     2. EVENT STREAMING                                  â”‚  â”‚
â”‚  â”‚                                                                         â”‚  â”‚
â”‚  â”‚   kafka_producer.py â”€â”€â–º Kafka (KRaft) â”€â”€â–º kafka_consumer.py            â”‚  â”‚
â”‚  â”‚        â”‚                     â”‚                    â”‚                     â”‚  â”‚
â”‚  â”‚        â””â”€â”€â”€â”€ Topic: sentinance.prices â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                               â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚         â–¼                    â–¼                    â–¼                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ PostgreSQL  â”‚     â”‚    Redis    â”‚     â”‚   Qdrant    â”‚                   â”‚
â”‚  â”‚ (persist)   â”‚     â”‚  (cache)    â”‚     â”‚  (vectors)  â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚         â”‚                   â”‚                   â”‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚                3. DATA PROCESSING                     â”‚                   â”‚
â”‚  â”‚                                                       â”‚                   â”‚
â”‚  â”‚   PostgreSQL â”€â”€â–º dbt staging â”€â”€â–º dbt marts           â”‚                   â”‚
â”‚  â”‚                       â”‚                â”‚              â”‚                   â”‚
â”‚  â”‚              stg_prices.sql    mart_daily_metrics    â”‚                   â”‚
â”‚  â”‚                                mart_technical_ind    â”‚                   â”‚
â”‚  â”‚                                                       â”‚                   â”‚
â”‚  â”‚   Spark â”€â”€â–º spark_features.py â”€â”€â–º Feature Store      â”‚                   â”‚
â”‚  â”‚                  (PySpark)              (Feast)       â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                              â”‚                                               â”‚
â”‚                              â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                     4. ML PIPELINE                                      â”‚  â”‚
â”‚  â”‚                                                                         â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚  â”‚
â”‚  â”‚   â”‚ train_lstm.py  â”‚  â”‚  predictor.py  â”‚  â”‚ drift_detect.pyâ”‚          â”‚  â”‚
â”‚  â”‚   â”‚ (training)     â”‚  â”‚  (inference)   â”‚  â”‚ (monitoring)   â”‚          â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚  â”‚
â”‚  â”‚           â”‚                   â”‚                   â”‚                    â”‚  â”‚
â”‚  â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚  â”‚
â”‚  â”‚                               â–¼                                        â”‚  â”‚
â”‚  â”‚                         MLflow Tracking                                 â”‚  â”‚
â”‚  â”‚                    (params, metrics, artifacts)                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                               â”‚
â”‚                              â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                     5. AI/RAG LAYER                                     â”‚  â”‚
â”‚  â”‚                                                                         â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚   â”‚               llm_wrapper.py (NEW!)                              â”‚ â”‚  â”‚
â”‚  â”‚   â”‚                                                                  â”‚ â”‚  â”‚
â”‚  â”‚   â”‚   User Query â”€â”€â–º Retrieve Historical Predictions (Qdrant)       â”‚ â”‚  â”‚
â”‚  â”‚   â”‚                              â”‚                                   â”‚ â”‚  â”‚
â”‚  â”‚   â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚ â”‚  â”‚
â”‚  â”‚   â”‚        â–¼                                           â–¼            â”‚ â”‚  â”‚
â”‚  â”‚   â”‚   Current Context                        Historical Context     â”‚ â”‚  â”‚
â”‚  â”‚   â”‚   (prices, indicators)                   (past predictions)     â”‚ â”‚  â”‚
â”‚  â”‚   â”‚        â”‚                                           â”‚            â”‚ â”‚  â”‚
â”‚  â”‚   â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚ â”‚  â”‚
â”‚  â”‚   â”‚                              â–¼                                   â”‚ â”‚  â”‚
â”‚  â”‚   â”‚                    Gemini AI / Groq                              â”‚ â”‚  â”‚
â”‚  â”‚   â”‚                              â”‚                                   â”‚ â”‚  â”‚
â”‚  â”‚   â”‚                              â–¼                                   â”‚ â”‚  â”‚
â”‚  â”‚   â”‚               Store Prediction â”€â”€â–º Update Accuracy              â”‚ â”‚  â”‚
â”‚  â”‚   â”‚                    (for future learning)                         â”‚ â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                         â”‚  â”‚
â”‚  â”‚   agent.py (LangGraph) â”€â”€â–º Planner â”€â”€â–º Researcher â”€â”€â–º Analyst         â”‚  â”‚
â”‚  â”‚         â”‚                                    â”‚                          â”‚  â”‚
â”‚  â”‚         â””â”€â”€ Tools: get_price, indicators, order_book, news â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                               â”‚
â”‚                              â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                     6. API LAYER                                        â”‚  â”‚
â”‚  â”‚                                                                         â”‚  â”‚
â”‚  â”‚   FastAPI (main.py)                                                    â”‚  â”‚
â”‚  â”‚   â”œâ”€â”€ REST Endpoints                                                   â”‚  â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ GET /prices                                                  â”‚  â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ POST /chat                                                   â”‚  â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ GET /predictions/{symbol}                                    â”‚  â”‚
â”‚  â”‚   â”‚   â””â”€â”€ POST /alerts                                                 â”‚  â”‚
â”‚  â”‚   â”‚                                                                     â”‚  â”‚
â”‚  â”‚   â”œâ”€â”€ WebSocket /ws/prices                                             â”‚  â”‚
â”‚  â”‚   â”‚   â””â”€â”€ Real-time price streaming                                    â”‚  â”‚
â”‚  â”‚   â”‚                                                                     â”‚  â”‚
â”‚  â”‚   â””â”€â”€ Middleware                                                       â”‚  â”‚
â”‚  â”‚       â”œâ”€â”€ CORS (restricted origins)                                    â”‚  â”‚
â”‚  â”‚       â”œâ”€â”€ Rate Limiting (Redis)                                        â”‚  â”‚
â”‚  â”‚       â””â”€â”€ Metrics (Prometheus)                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                               â”‚
â”‚                              â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                     7. FRONTEND                                         â”‚  â”‚
â”‚  â”‚                                                                         â”‚  â”‚
â”‚  â”‚   Next.js 16 (apps/web/)                                               â”‚  â”‚
â”‚  â”‚   â”œâ”€â”€ Server Components (RSC)                                          â”‚  â”‚
â”‚  â”‚   â”œâ”€â”€ Client Components (price cards, chat)                            â”‚  â”‚
â”‚  â”‚   â””â”€â”€ WebSocket Hook (real-time updates)                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… Verified Integrations by Layer

### Layer 1: Data Sources â†’ Ingestion
| Component | Integrated With | Status |
|-----------|----------------|--------|
| Binance API | multi_exchange.py | âœ… Live |
| Coinbase API | multi_exchange.py | âœ… Live |
| Kraken API | multi_exchange.py | âœ… Live |
| News RSS | news_scraper.py | âœ… Live |

### Layer 2: Ingestion â†’ Storage
| Component | Integrated With | Status |
|-----------|----------------|--------|
| multi_exchange.py | Redis (cache) | âœ… Connected |
| multi_exchange.py | PostgreSQL | âœ… Connected |
| kafka_producer.py | Kafka | âœ… Configured |
| news_scraper.py | Qdrant | âœ… Connected |

### Layer 3: Storage â†’ Processing
| Component | Integrated With | Status |
|-----------|----------------|--------|
| PostgreSQL | dbt staging | âœ… Configured |
| dbt staging | dbt marts | âœ… Configured |
| Parquet data | PySpark | âœ… Configured |
| Spark output | Feast | âœ… Configured |

### Layer 4: Processing â†’ ML
| Component | Integrated With | Status |
|-----------|----------------|--------|
| Feature Store | LSTM training | âœ… Connected |
| LSTM model | MLflow | âœ… Logging |
| Predictions | drift_detection.py | âœ… Monitoring |
| Model versions | A/B testing | âœ… Framework |

### Layer 5: ML â†’ API
| Component | Integrated With | Status |
|-----------|----------------|--------|
| predictor.py | /predictions endpoint | âœ… Live |
| agent.py | /chat endpoint | âœ… Live |
| llm_wrapper.py | Historical RAG | âœ… NEW |
| indicators.py | Agent tools | âœ… Live |

### Layer 6: API â†’ Frontend
| Component | Integrated With | Status |
|-----------|----------------|--------|
| REST endpoints | Next.js fetch | âœ… Connected |
| WebSocket | React hooks | âœ… Streaming |

---

## ğŸ§  RAG Historical Learning Flow (NEW)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    HISTORICAL RAG LEARNING SYSTEM                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   1. USER QUERY                                                          â”‚
â”‚      "What's BTC going to do in the next 24h?"                          â”‚
â”‚                        â”‚                                                 â”‚
â”‚                        â–¼                                                 â”‚
â”‚   2. RETRIEVE SIMILAR HISTORY (Qdrant Vector Search)                    â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚      â”‚  Past Prediction #1 (Similarity: 92%)                       â”‚     â”‚
â”‚      â”‚  - Query: "BTC 24h prediction"                              â”‚     â”‚
â”‚      â”‚  - Predicted: BULLISH at $94,500                            â”‚     â”‚
â”‚      â”‚  - Actual: BULLISH at $95,200                               â”‚     â”‚
â”‚      â”‚  - Accuracy: 87%                                            â”‚     â”‚
â”‚      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚      â”‚  Past Prediction #2 (Similarity: 85%)                       â”‚     â”‚
â”‚      â”‚  - Query: "Short term BTC outlook"                          â”‚     â”‚
â”‚      â”‚  - Predicted: BEARISH at $93,000                            â”‚     â”‚
â”‚      â”‚  - Actual: BULLISH at $96,000                               â”‚     â”‚
â”‚      â”‚  - Accuracy: 32%                                            â”‚     â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                        â”‚                                                 â”‚
â”‚                        â–¼                                                 â”‚
â”‚   3. COMBINE CONTEXT                                                     â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚      â”‚  CURRENT DATA           â”‚  HISTORICAL CONTEXT              â”‚    â”‚
â”‚      â”‚  - Price: $97,500       â”‚  - Index avg accuracy: 72%       â”‚    â”‚
â”‚      â”‚  - RSI: 65              â”‚  - Similar predictions: 5        â”‚    â”‚
â”‚      â”‚  - MACD: bullish        â”‚  - Success patterns: [...]       â”‚    â”‚
â”‚      â”‚  - Volume: high         â”‚  - Failed patterns: [...]        â”‚    â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                        â”‚                                                 â”‚
â”‚                        â–¼                                                 â”‚
â”‚   4. LLM REASONING (Gemini/Groq with fallback)                          â”‚
â”‚      "Based on current indicators AND historical accuracy,               â”‚
â”‚       I predict BULLISH with 75% confidence..."                          â”‚
â”‚                        â”‚                                                 â”‚
â”‚                        â–¼                                                 â”‚
â”‚   5. STORE NEW PREDICTION                                                â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚      â”‚  ID: abc123                                                 â”‚     â”‚
â”‚      â”‚  Symbol: BTCUSDT                                            â”‚     â”‚
â”‚      â”‚  Predicted: BULLISH at $99,000                              â”‚     â”‚
â”‚      â”‚  Confidence: 75%                                            â”‚     â”‚
â”‚      â”‚  Timestamp: 2026-01-24T01:30:00Z                            â”‚     â”‚
â”‚      â”‚  Status: PENDING VERIFICATION                               â”‚     â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                        â”‚                                                 â”‚
â”‚                        â–¼                                                 â”‚
â”‚   6. LATER: VERIFY & LEARN                                               â”‚
â”‚      After 24h, actual price recorded:                                   â”‚
â”‚      - Actual: BULLISH at $98,500                                        â”‚
â”‚      - Accuracy calculated: 83%                                          â”‚
â”‚      - Index accuracy updated: 73% â†’ 74%                                 â”‚
â”‚      - Stored for future retrieval                                       â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Per-Index Historical Memory

Each crypto/index maintains its own learning profile:

| Index | Collection | Metrics Tracked |
|-------|------------|-----------------|
| BTCUSDT | sentinance_history | predictions, accuracy, patterns |
| ETHUSDT | sentinance_history | predictions, accuracy, patterns |
| SOLUSDT | sentinance_history | predictions, accuracy, patterns |
| ^GSPC | sentinance_history | predictions, accuracy, patterns |
| ^NSEI | sentinance_history | predictions, accuracy, patterns |

---

## ğŸ”§ Key Integration Points

### 1. Real-Time Price â†’ Agent â†’ RAG
```python
# In agent.py researcher_node():
from multi_exchange import fetch_binance_prices
from llm_wrapper import chat_with_history

# Fetch real prices
prices = await fetch_binance_prices(client)

# Chat with historical context
response = await chat_with_history(
    symbol="BTCUSDT",
    query=user_query,
    current_context={"prices": prices, "indicators": indicators}
)
```

### 2. Prediction â†’ Verify â†’ Learn
```python
# After actual outcome is known:
from llm_wrapper import get_llm_wrapper

wrapper = get_llm_wrapper()
await wrapper.verify_prediction(
    prediction_id="abc123",
    actual_price=98500
)
# Index accuracy automatically updated
```

### 3. Feature Store â†’ Training
```python
# In train_lstm.py:
from apps.feature_store.feature_store import get_feature_service

service = get_feature_service()
features = service.get_online_features(
    feature_refs=["price_features:close_price", "technical_indicators:rsi_14"],
    entity_rows=[{"symbol": "BTCUSDT"}]
)
```
